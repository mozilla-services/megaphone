language: rust
sudo: false
cache: cargo

rust:
  - nightly
env:
  global:
    # XXX: begin_test_transaction doesn't play nice over threaded tests
    - RUST_TEST_THREADS=1
    - ROCKET_DATABASE_URL="mysql://travis@127.0.0.1/megaphone"

services:
  - mysql

# XXX: kill the diesel_cli requirement:
# https://docs.rs/diesel/0.16.0/diesel/macro.embed_migrations.html
before_script:
  - mysql -e 'CREATE DATABASE IF NOT EXISTS megaphone;'
  - |
    cargo install diesel_cli --no-default-features --features mysql || \
    echo "diesel_cli already installed"
  - diesel setup --database-url $ROCKET_DATABASE_URL
